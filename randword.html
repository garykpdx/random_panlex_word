<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Random PanLex Expression</title>
    <script src="jquery-3.1.0.js"></script>
    <script>
        function fetch() {
            $.post("http://api.panlex.org/lv",
				JSON.stringify({sort: "random", limit: 1}),
				function(data, status) {
					console.log(JSON.stringify(data.result[0]));
					
					$.post("http://api.panlex.org/ex",
						JSON.stringify({"lv":data.result[0].lv, "limit":1, "sort":"random"}),
						
							function(data2, status) {
								console.log(JSON.stringify(data2));
								document.getElementById("english_word").innerHTML = '';
								document.getElementById("results").innerHTML = data2.result[0].tt;
								var variety = data.result[0].tt + " (" + data.result[0].uid + ")";
								document.getElementById("lang").innerHTML = variety;
								
								var params = {"trtt": data.result[0].tt, "include": "trq", "lv":187, 
								                "trlv":data.result[0].lv, "sort":"trq desc", "limit":1 };
								console.log("PARAMS: " + JSON.stringify(params));
								
								$.post("http://api.panlex.org/ex",
            						JSON.stringify( params),
            						
            						function(data3, status) {
            						    console.log('NAME TRANS: ' + JSON.stringify(data3));
            						    if (data3.resultNum > 0) {
                                            var eng_lang_name = data3.result[0].tt;
                                            document.getElementById("lang_name_eng").innerHTML = eng_lang_name;
								        }
								        else {
								            document.getElementById("lang_name_eng").innerHTML = "&nbsp;";
								        }
            						},
            						"json");
            						
            					set_translation(data2.result[0].tt, data.result[0].lv);
							},
						"json"
					);
				},
            "json");
        }
        
        $(document).ready(function () {
            $("#fetch").click(fetch);
        });
        
        
        function set_translation(word, lang_variety) {
            params = {"trtt":word, "trlv":lang_variety, "lv":187, "include":["trq"], "limit":1, "sort":"trq desc"};
            console.log("GET TRANS: " + JSON.stringify(params));
            
            $.post("http://api.panlex.org/ex",
                JSON.stringify(params),
                
                function(response, status) {
                    console.log("TRANSLATION RESULTS: " + JSON.stringify(response.result));
                    
                    if (response.resultNum > 0 && response.result[0].trq > 10) {
						document.getElementById("english_word").innerHTML = response.result[0].tt;
					} else {
						// try with distance 2 translation
						params = {"trdistance":2, "trtt":word, "trlv":lang_variety, "lv":187, "include":["trq"], 
						            "limit":1, "sort":"trq desc"};
						$.post("http://api.panlex.org/ex", JSON.stringify(params),
						    function(response, status) {
						        console.log("D2 TRANSLATION RESULTS: " + JSON.stringify(response.result));
						        if (response.result[0].trq > 10) {
						            document.getElementById("english_word").innerHTML = response.result[0].tt;
						        }
						    },
						    "json");
					}
                },
                "json");
        }
    </script>
    <style>
        body {background:#d7d0b7;}
        h1 {color:black;text-align:center;}
        p {text-align:center;}
		p.intro {text-align:left;}
        div {text-align:left;}
        table {border-collapse: collapse;width:9in;margin-left:auto; margin-right:auto;}
        tr.values {background:#ccbbaa;border-bottom:1px solid #888;}
        td#results {width:0%;}
        td {padding-right: 15px; padding-left: 10px;}
        td.btn {text-align:center;padding-top:10px;padding-bottom:10px;width:50%;}
        td.eng_lang {color:blue;}
    </style>
</head>
<body>
<h1>Random PanLex Expression</h1>
<table><tr><td>
    <p class="intro">
        This is my unofficial PanLex random word selector. 
        It chooses an expression at random from the PanLex database in a randomly chosen language.
    </p>
	<p class="intro">
        Note that some languages do not have any data added yet.
        If you want to see PanLex add data to your favorite language,
        and you know of some dictionary or other source, let them know so they can include it.
    </p>
</td></tr></table>
<br>

<div>
    <table>
        <tr class="values">
            <td><nobr><b>Random expression</b></nobr></td>
            <td id="results">&nbsp;</td>
            <td class="eng_lang" id="english_word"></td>
        </tr>
        <tr class="values">
            <td><nobr><b>Language variety</b></nobr></td>
            <td id="lang">&nbsp;</td>
            <td class="eng_lang" id="lang_name_eng"></td>
        </tr>
        <!-- <tr class="values"><td><nobr><b></b></nobr></td><td id="trans">&nbsp;</td></tr> -->
        <tr>
            <td colspan="3" class="btn">
                <button id="fetch">Fetch</button>
            </td>
        </tr>
    </table>
</div>
<p>Find out more about the project on the <a href="http://panlex.org" target="_blank">PanLex website</a>.</p>
</body>
</html>
